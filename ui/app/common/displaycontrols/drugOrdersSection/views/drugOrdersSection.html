<section>
    <h2 class="has-toggle section-title" ng-click="toggleDisplay()" ng-if="config | titleTranslate">
        <i class="fa fa-caret-right" ng-hide="toggle"></i>
        <i class="fa fa-caret-down ng-hide" ng-show="toggle"></i>
        <span class="section-label">{{ config | titleTranslate }}</span>
    </h2>
    <div class="drugOrderTable" ng-if="toggle && drugOrders && drugOrders.length > 0">
        <p class="placeholder-text" ng-if="drugOrders && drugOrders.length == 0" ng-show="toggle">
            {{'NO_DRUG_DETAILS_MESSAGE' | translate}}
        </p>
        <div class="drugOrderTableScroll noOfActions-{{::config.actions.length}}-width">
            <table class="drug-order-table treatments-details-table"
                   ng-class="{'drug-order-table-discontinue' : drugOrder.isMarkedForDiscontinue }">
                <thead>
                <tr>
                    <th ng-class="{ 'active-drugs' : columns.length ===5 ,
                    '{{::columnName}}':true }" ng-repeat="columnName in columns"><span>{{columnHeaders[columnName] | translate}}</span></th>
                    <th class="empty-header noOfActions-{{::config.actions.length}}-width">{{ 'MEDICATIONS_ACTIONS_LABEL'|translate }}</th>
                </tr>
                </thead>
                <tbody ng-repeat="drugOrder in drugOrders">
                <tr ng-class="{'highlight' : drugOrder.isBeingEdited, 'edited' : drugOrder.isMarkedForDiscontinue}">
                    <td class="{{columnName}}" ng-class="{'drugNameStopForm' : drugOrder.isMarkedForDiscontinue && columnName === 'drugName' ,'drugNameAddNote': drugOrder.showAdditionalInstructions  && columnName === 'drugName' ,'drugNameStopFormAddNote':  drugOrder.isMarkedForDiscontinue && drugOrder.showAdditionalInstructions  && columnName === 'drugName'}"
                        ng-repeat="columnName in columns">
                        <span ng-if="columnName === 'dosage'">{{::drugOrder.getDoseAndUnits()}}</span>
                    <span ng-if="columnName === 'drugName' && !isDrugOrderSet"
                          title="{{::drugOrder.getDrugOrderName(false)}}">
                        {{::drugOrder.getDrugOrderName(false)}}
                    </span>
                    <span ng-if="columnName === 'drugName' && isDrugOrderSet"
                          title="{{::drugOrder.drugNameDisplay}}">
                        <input class="fl orderSetStagingAreaCheckbox" ng-click="checkConflictingDrug(drugOrder)"
                               ng-model="drugOrder.include"
                               type="checkbox"/>
                        {{::drugOrder.drugNameDisplay}}
                    </span>
                        <span ng-if="columnName === 'route'">{{::drugOrder.route}}</span>
                        <span ng-if="columnName === 'duration'">{{::drugOrder.getDurationAndDurationUnits()}}</span>
                    <span ng-if="columnName === 'frequency'">
                        {{::drugOrder.getFrequency()}}
                        <span ng-if="drugOrder.asNeeded">
                            , {{::'MEDICATION_AS_NEEDED' | translate}}
                        </span>
                    </span>
                        <span ng-if="columnName === 'startDate'">{{::drugOrder.effectiveStartDate | bahmniDate}}</span>
                        <span ng-if="columnName === 'stopDate' && drugOrder.isDiscontinuedOrStopped()">{{::drugOrder.effectiveStopDate | bahmniDate}}</span>
                    <span ng-if="columnName === 'stopReason' && drugOrder.orderReasonConcept && drugOrder.isDiscontinuedOrStopped()">
                        {{::drugOrder.orderReasonConcept.display || drugOrder.orderReasonConcept.name}}
                        <span ng-if="drugOrder.orderReasonText"> - {{::drugOrder.orderReasonText}}</span>
                    </span>
                        <span ng-if="columnName === 'instructions'">{{::drugOrder.instructions}}</span>
                        <span ng-if="columnName === 'quantity'">{{::drugOrder.getQuantityWithUnit()}}</span>
                    </td>
                    <td class="buttonColumn" ng-class="{'noActionColumn' :!config.actions ,
                            'noActionColumnAddNote' : !config.actions && drugOrder.showAdditionalInstructions ,
                            'buttonColumnStopForm' : drugOrder.isMarkedForDiscontinue ,
                            'buttonColumnAddNote': drugOrder.showAdditionalInstructions ,
                            'noOfActions-{{::config.actions.length}}-width' :true,
                            'buttonColumnStopFormAddNote' : drugOrder.isMarkedForDiscontinue && drugOrder.showAdditionalInstructions }">
                        <div class="button-group-wrapper">
                            <div class="button-group" ng-if="config.actions"
                                 ng-repeat="actionName in config.actions">
                                <button confirm-message="{{ 'REMOVE_DRUG_ORDER_KEY' | translate: {drugName :drugOrder.drugNameDisplay} }}"
                                        ng-confirm-click="remove(drugOrder)"
                                        ng-if="actionName=='void'"><i class="fa fa-remove"></i></button>
                                <button ng-click="revise(drugOrder, drugOrders)"
                                        ng-disabled="!drugOrder.isActive() || !drugOrder.isEditAllowed"
                                        ng-if="actionName=='revise'">
                                    <i class="fa fa-edit"></i>
                                </button>
                                <button ng-click="edit(drugOrder)"
                                        ng-disabled="!drugOrder.include || !drugOrder.isActive() || !drugOrder.isEditAllowed"
                                        ng-if="actionName=='edit'">
                                    <i class="fa fa-edit"></i>
                                </button>
                                <button class="undo-btn"
                                        ng-click="undoDiscontinue(drugOrder)"
                                        ng-disabled="!drugOrder.isActive() || !drugOrder.isDiscontinuedAllowed"
                                        ng-if=" actionName=='stop' && drugOrder.isMarkedForDiscontinue">
                                    <i class="fa fa-undo"></i>
                                </button>
                                <button class="stop-drug-btn"
                                        ng-click="discontinue(drugOrder)"
                                        ng-disabled="!drugOrder.isActive() || !drugOrder.isDiscontinuedAllowed"
                                        ng-if="actionName=='stop' && !drugOrder.isMarkedForDiscontinue">
                                    {{ 'MEDICATIONS_STOP_LABEL'|translate }}
                                </button>
                                <button class="refill-btn" ng-click="refill(drugOrder)"
                                        ng-disabled="!drugOrder.effectiveStopDate || drugOrder.isDrugRetired"
                                        ng-if="actionName=='refill'">
                                    {{ 'MEDICATIONS_REFILL_LABEL'|translate }}
                                </button>
                            </div>
                            <button class="toggle"
                                    ng-class="{'has-notes': drugOrder.additionalInstructions}"
                                    toggle="drugOrder.showAdditionalInstructions">
                                <i class="fa fa-plus-circle"></i>
                                <i class="fa fa-minus-circle"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                <tr class="medicationDrugNotes" ng-if="drugOrder.showAdditionalInstructions">
                    <td colspan="{{columns.length + 1}}" class="form drug-stop-container">
                        <div class="notes inline-notes"
                             ng-show="drugOrder.showAdditionalInstructions">
                            <span class="additionalInstructions fl">{{::drugOrder.additionalInstructions}}</span>
                            <div class="footer-note fl">
                            <span class="time-stamp">
                                <span class="time">{{drugOrder.dateActivated | bahmniDate}}</span>
                            </span>
                            <span class="provider">
                                <provider-directive creator-name="{{drugOrder.creatorName}}"
                                                    provider-name="{{drugOrder.provider.name}}"></provider-directive>
                            </span>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr ng-if="drugOrder.isMarkedForDiscontinue" ng-class="{'formStopReason' : drugOrder.isMarkedForDiscontinue}">
                    <td colspan="{{columns.length + 1}}" class="form drug-stop-container">
                        <article class="form-field">
                            <div class="field-attribute stop-date-label">
                                <label class="control-label">{{ 'DRUG_DETAILS_STOP_DATE'|translate }}</label>
                            </div>
                            <div class="field-value">
                                <input id="date-stopped" max="{{::scheduledDate}}"
                                       min="{{::getMinDateForDiscontinue(drugOrder)}}"
                                       ng-model="drugOrder.dateStopped" required="required"
                                       type="date">
                            </div>
                            <div class="field-value" ng-if="config.captureStopReason">
                                <select class="form-field instruction" id="stopped-reason"
                                        ng-change="updateFormConditions(drugOrder)"
                                        ng-model="drugOrder.orderReasonConcept"
                                        ng-options="item as item.display for item in stoppedOrderReasons">
                                    <option value="">{{ 'MEDICATION_RECENT_TAB_STOP_REASON' | translate }}</option>
                                </select>
                            </div>
                            <div class="field-value" ng-if="config.captureStopReason">
                            <textarea class="form-field drug-order-notes" id="stopped-reason-non-coded"
                                      ng-disabled="!drugOrder.orderReasonNotesEnabled"
                                      ng-model="drugOrder.orderReasonText"
                                      placeholder="{{ 'MEDICATION_RECENT_TAB_STOP_NOTES' | translate}}"
                                      rows="1"></textarea>
                            </div>
                        </article>
                    </td>
                </tr>

                </tbody>
            </table>
        </div>
    </div>
</section>
